# NKOshka Bot - Telegram –±–æ—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –ù–ö–û

–§—Ä–æ–Ω—Ç–µ–Ω–¥ Telegram –±–æ—Ç–∞ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –¥–ª—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram –ë–æ—Ç ‚Üí AI –ê–≥–µ–Ω—Ç (–Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ) ‚Üí –ë—ç–∫–µ–Ω–¥ ‚Üí AI (GigaChat/Kandinsky)
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö:

1. **–ë–æ—Ç** –ø–æ–ª—É—á–∞–µ—Ç –∫–æ–º–∞–Ω–¥—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç JSON
2. **–ë–æ—Ç ‚Üí AI –∞–≥–µ–Ω—Ç**: –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON —á–µ—Ä–µ–∑ POST –∑–∞–ø—Ä–æ—Å –Ω–∞ `AI_AGENT_URL`
3. **AI –∞–≥–µ–Ω—Ç** (–Ω–∞ –¥—Ä—É–≥–æ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ) —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –ø—Ä–æ–º–ø—Ç –∏ –≤—ã–∑—ã–≤–∞–µ—Ç –±—ç–∫–µ–Ω–¥
4. **AI –∞–≥–µ–Ω—Ç ‚Üí –ë–æ—Ç**: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç PostJSON
5. **–ë–æ—Ç** –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Go 1.21+
- Telegram Bot Token

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞

1. –°–æ–∑–¥–∞–π —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:
```
BOT_TOKEN=your_telegram_bot_token
AI_AGENT_URL=http://your-ai-agent-url:8000
```

2. –£—Å—Ç–∞–Ω–æ–≤–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Go:
```bash
go mod download
```

## –ó–∞–ø—É—Å–∫

```bash
go run main.go
```

## –§—É–Ω–∫—Ü–∏–∏ –±–æ—Ç–∞

- üìù **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞** - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ—Å—Ç–æ–≤ (—Å–≤–æ–±–æ–¥–Ω–∞—è —Ñ–æ—Ä–º–∞ –∏–ª–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–∞—è)
- üé® **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–∫–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ –æ–ø–∏—Å–∞–Ω–∏—é
- ‚úèÔ∏è **–†–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–∞** - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫ –∏ —É–ª—É—á—à–µ–Ω–∏–µ —Å—Ç–∏–ª—è
- üìÖ **–ö–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω** - —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–ª–∞–Ω–æ–≤ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
- ‚öôÔ∏è **–í–≤–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ –ù–ö–û** - –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ main.go              # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–æ—Ç–∞
‚îú‚îÄ‚îÄ handlers.go          # –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ callback'–æ–≤
‚îú‚îÄ‚îÄ keyboards.go         # –ö–ª–∞–≤–∏–∞—Ç—É—Ä—ã (inline –∏ reply)
‚îú‚îÄ‚îÄ models.go            # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ states.go            # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ù–ö–û
‚îú‚îÄ‚îÄ backend.go           # –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è —Å AI –∞–≥–µ–Ω—Ç–æ–º
‚îú‚îÄ‚îÄ nko_data.json        # –°–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –ù–ö–û (—Å–æ–∑–¥–∞—ë—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îú‚îÄ‚îÄ go.mod               # Go –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ go.sum               # Go –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ .env                 # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

## –§–æ—Ä–º–∞—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ AI –∞–≥–µ–Ω—Ç

### –î–ª—è `/api/auth/init` (–ø—Ä—è–º–æ–π —Ñ–æ—Ä–º–∞—Ç):
```json
{
  "tg_id": 123456789,
  "username": "test_user"
}
```

### –î–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö endpoints (–æ–±—ë—Ä–Ω—É—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç):
```json
{
  "endpoint": "/generate_text",
  "data": {
    "prompt": "–°–æ–∑–¥–∞–π –ø–æ—Å—Ç...",
    "nko": {
      "name": "–ù–∞–∑–≤–∞–Ω–∏–µ –ù–ö–û",
      "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
      "activities": "–î–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å",
      "style": "—Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π"
    }
  },
  "tg_id": 123456789,
  "timestamp": 1703520000
}
```

AI –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å `PostJSON`:

```json
{
  "post_id": "uuid",
  "post_author": 123456789,
  "assigned_chat_id": [],
  "main_text": "–¢–µ–∫—Å—Ç –ø–æ—Å—Ç–∞",
  "content": [
    {
      "layer_id": "uuid",
      "type": "image",
      "order_index": 0,
      "data": {
        "image_base64": "base64_encoded_image_string",
        "x": 50,
        "y": 100,
        "scale": 1.0,
        "rotation": 0,
        "opacity": 1.0
      }
    }
  ]
}
```

**–í–∞–∂–Ω–æ:** –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ base64 –≤ –ø–æ–ª–µ `image_base64` (–Ω–µ URL).

## Endpoints AI –∞–≥–µ–Ω—Ç–∞

–ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–µ endpoints:

### –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (–ø—Ä—è–º–æ–π —Ñ–æ—Ä–º–∞—Ç, –±–µ–∑ –æ–±—ë—Ä—Ç–∫–∏):
- `POST /api/auth/init` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `{"tg_id": ..., "username": ...}`)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–æ–±—ë—Ä–Ω—É—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç):
- `POST /generate_text` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞
- `POST /generate_image` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
- `POST /edit_text` - —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
- `POST /content_plan` - —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–∞
- `POST /send_post` - –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ—Å—Ç–∞
- `POST /regenerate_post` - –ø–µ—Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ—Å—Ç–∞

**–í–∞–∂–Ω–æ:** –î–ª—è `/api/auth/init` –±–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –Ω–∞–ø—Ä—è–º—É—é, –¥–ª—è –æ—Å—Ç–∞–ª—å–Ω—ã—Ö endpoints –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–±—ë—Ä–Ω—É—Ç—ã–π —Ñ–æ—Ä–º–∞—Ç —Å –ø–æ–ª—è–º–∏ `endpoint`, `data`, `tg_id`, `timestamp`.

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–∞–Ω–Ω—ã–µ –ù–ö–û —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `nko_data.json` –∏ –Ω–µ —Ç–µ—Ä—è—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ
- –ë–æ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç JSON –≤ AI –∞–≥–µ–Ω—Ç —á–µ—Ä–µ–∑ POST –∑–∞–ø—Ä–æ—Å—ã
- AI –∞–≥–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ `AI_AGENT_URL`
- –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ù–ö–û —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞

